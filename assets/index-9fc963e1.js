import{M as _,S as J,u as T,y as w,O as X,A as p,e as d,T as L,j as R,v as N,C as ee,q as oe,N as te,Q as ne,P as ae,V as se,F as le,D as A}from"./vue-libs-9b0981d5.js";import{n as k,t as y,d as K,o as ce,R as re,z as $,c as j,q as M,e as F,l as ie,B as H,w as G,g,I as ue}from"./index-137ae4a8.js";import{u as de,a as fe,P as ve,c as ye}from"./use-touch-7ef5a55b.js";import{H as me}from"./use-route-8dafc2dc.js";let Ie=2e3;const he=()=>++Ie,U={show:Boolean,zIndex:k,overlay:y,duration:k,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:K,transitionAppear:Boolean,closeOnClickOverlay:y},De=Object.keys(U);let I=0;const B="van-overflow-hidden";function Oe(e,o){const n=de(),f="01",a="10",c=r=>{n.move(r);const v=n.deltaY.value>0?a:f,x=re(r.target,e.value),{scrollHeight:m,offsetHeight:O,scrollTop:C}=x;let i="11";C===0?i=O>=m?"00":"01":C+O>=m&&(i="10"),i!=="11"&&n.isVertical()&&!(parseInt(i,2)&parseInt(v,2))&&$(r,!0)},s=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",c,{passive:!1}),I||document.body.classList.add(B),I++},l=()=>{I&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",c),I--,I||document.body.classList.remove(B))},S=()=>o()&&s(),h=()=>o()&&l();ce(S),_(h),J(h),T(o,r=>{r?s():l()})}function V(e){const o=w(!1);return T(e,n=>{n&&(o.value=n)},{immediate:!0}),n=>()=>o.value?n():null}const D=()=>{var e;const{scopeId:o}=((e=X())==null?void 0:e.vnode)||{};return o?{[o]:""}:null},[Ce,Pe]=j("overlay"),we={show:Boolean,zIndex:k,duration:k,className:K,lockScroll:y,lazyRender:y,customStyle:Object};var ke=p({name:Ce,props:we,setup(e,{slots:o}){const n=w(),f=V(()=>e.show||!e.lazyRender),a=s=>{e.lockScroll&&$(s,!0)},c=f(()=>{var s;const l=F(ie(e.zIndex),e.customStyle);return H(e.duration)&&(l.animationDuration=`${e.duration}s`),R(d("div",{ref:n,style:l,class:[Pe(),e.className]},[(s=o.default)==null?void 0:s.call(o)]),[[N,e.show]])});return M("touchmove",a,{target:n}),()=>d(L,{name:"van-fade",appear:!0},{default:c})}});const Se=G(ke),xe=F({},U,{round:Boolean,position:g("center"),closeIcon:g("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:g("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[be,E]=j("popup");var ge=p({name:be,inheritAttrs:!1,props:xe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:n,slots:f}){let a,c;const s=w(),l=w(),S=V(()=>e.show||!e.lazyRender),h=ee(()=>{const t={zIndex:s.value};if(H(e.duration)){const u=e.position==="center"?"animationDuration":"transitionDuration";t[u]=`${e.duration}s`}return t}),r=()=>{a||(a=!0,s.value=e.zIndex!==void 0?+e.zIndex:he(),o("open"))},v=()=>{a&&ye(e.beforeClose,{done(){a=!1,o("close"),o("update:show",!1)}})},x=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&v()},m=()=>{if(e.overlay)return d(Se,A({show:e.show,class:e.overlayClass,zIndex:s.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},D(),{onClick:x}),{default:f["overlay-content"]})},O=t=>{o("clickCloseIcon",t),v()},C=()=>{if(e.closeable)return d(ue,{role:"button",tabindex:0,name:e.closeIcon,class:[E("close-icon",e.closeIconPosition),me],classPrefix:e.iconPrefix,onClick:O},null)};let i;const Y=()=>{i&&clearTimeout(i),i=setTimeout(()=>{o("opened")})},Z=()=>o("closed"),q=t=>o("keydown",t),Q=S(()=>{var t;const{round:u,position:P,safeAreaInsetTop:b,safeAreaInsetBottom:W}=e;return R(d("div",A({ref:l,style:h.value,role:"dialog",tabindex:0,class:[E({round:u,[P]:P}),{"van-safe-area-top":b,"van-safe-area-bottom":W}],onKeydown:q},n,D()),[(t=f.default)==null?void 0:t.call(f),C()]),[[N,e.show]])}),z=()=>{const{position:t,transition:u,transitionAppear:P}=e,b=t==="center"?"van-fade":`van-popup-slide-${t}`;return d(L,{name:u||b,appear:P,onAfterEnter:Y,onAfterLeave:Z},{default:Q})};return T(()=>e.show,t=>{t&&!a&&(r(),n.tabindex===0&&oe(()=>{var u;(u=l.value)==null||u.focus()})),!t&&a&&(a=!1,o("close"))}),fe({popupRef:l}),Oe(l,()=>e.show&&e.lockScroll),M("popstate",()=>{e.closeOnPopstate&&(v(),c=!1)}),te(()=>{e.show&&r()}),ne(()=>{c&&(o("update:show",!0),c=!1)}),_(()=>{e.show&&e.teleport&&(v(),c=!0)}),ae(ve,()=>e.show),()=>e.teleport?d(se,{to:e.teleport},{default:()=>[m(),z()]}):d(le,null,[m(),z()])}});const Ee=G(ge);export{Ee as P,De as a,U as p};
