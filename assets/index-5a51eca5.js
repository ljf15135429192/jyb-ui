import{c as V,q as le,m as M,n as q,z as N,C,U as ce,s as J,t as R,D as re,h as _,d as F,g as j,v as me,x as ve,p as ue,I as ge,w as de}from"./index-137ae4a8.js";import{u as fe,a as Q,c as he}from"./use-touch-7ef5a55b.js";import{S as we,a as Pe}from"./index-14647d2a.js";import{P as Se}from"./index-9fc963e1.js";import{I as xe}from"./index-ff210e3d.js";import{L as Ie}from"./index-c9c363c8.js";import{T as U,L as ye,H as Ce}from"./use-route-8dafc2dc.js";import{A as ee,L as oe,y as z,C as W,u as O,e as g,N as Te,q as be,D as Ye}from"./vue-libs-9b0981d5.js";const G=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),Xe=o=>({x:(o[0].clientX+o[1].clientX)/2,y:(o[0].clientY+o[1].clientY)/2}),L=V("image-preview")[1],K=2.6,Re={src:String,show:Boolean,active:Number,minZoom:M(q),maxZoom:M(q),rootWidth:M(Number),rootHeight:M(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean};var Ze=ee({props:Re,emits:["scale","close","longPress"],setup(o,{emit:m,slots:w}){const e=oe({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=fe(),n=z(),S=z(),T=z(!1),d=z(!1);let b=0;const D=W(()=>{const{scale:t,moveX:a,moveY:s,moving:l,zooming:c,initializing:h}=e,k={transitionDuration:c||l||h?"0s":".3s"};return(t!==1||d.value)&&(k.transform=`matrix(${t}, 0, 0, ${t}, ${a}, ${s})`),k}),u=W(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:a}=o,s=T.value?a/e.imageRatio:t;return Math.max(0,(e.scale*s-t)/2)}return 0}),P=W(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:a}=o,s=T.value?a:t*e.imageRatio;return Math.max(0,(e.scale*s-a)/2)}return 0}),Y=(t,a)=>{var s;if(t=C(t,+o.minZoom,+o.maxZoom+1),t!==e.scale){const l=t/e.scale;if(e.scale=t,a){const c=J((s=n.value)==null?void 0:s.$el),h={x:c.width*.5,y:c.height*.5},k=e.moveX-(a.x-c.left-h.x)*(l-1),ne=e.moveY-(a.y-c.top-h.y)*(l-1);e.moveX=C(k,-u.value,u.value),e.moveY=C(ne,-P.value,P.value)}else e.moveX=0,e.moveY=d.value?b:0;m("scale",{scale:t,index:o.active})}},x=()=>{Y(1)},$=()=>{const t=e.scale>1?1:2;Y(t,t===2||d.value?{x:r.startX.value,y:r.startY.value}:void 0)};let I,X,y,i,f,v,H,A,E=!1;const te=t=>{const{touches:a}=t;if(I=a.length,I===2&&o.disableZoom)return;const{offsetX:s}=r;r.start(t),X=e.moveX,y=e.moveY,A=Date.now(),E=!1,e.moving=I===1&&(e.scale!==1||d.value),e.zooming=I===2&&!s.value,e.zooming&&(i=e.scale,f=G(a))},ae=t=>{const{touches:a}=t;if(r.move(t),e.moving){const{deltaX:s,deltaY:l}=r,c=s.value+X,h=l.value+y;if((c>u.value||c<-u.value)&&!E&&r.isHorizontal()){e.moving=!1;return}E=!0,N(t,!0),e.moveX=C(c,-u.value,u.value),e.moveY=C(h,-P.value,P.value)}if(e.zooming&&(N(t,!0),a.length===2)){const s=G(a),l=i*s/f;v=Xe(a),Y(l,v)}},ie=t=>{var a;if(I>1)return;const{offsetX:s,offsetY:l}=r,c=Date.now()-A,h=250;if(s.value<U&&l.value<U)if(c<h)if(o.doubleScale)if(H)clearTimeout(H),H=null,$();else{if(!o.closeOnClickOverlay&&t.target===((a=S.value)==null?void 0:a.$el))return;H=setTimeout(()=>{m("close"),H=null},h)}else m("close");else c>ye&&m("longPress")},B=t=>{let a=!1;if((e.moving||e.zooming)&&(a=!0,e.moving&&X===e.moveX&&y===e.moveY&&(a=!1),!t.touches.length)){e.zooming&&(e.moveX=C(e.moveX,-u.value,u.value),e.moveY=C(e.moveY,-P.value,P.value),e.zooming=!1),e.moving=!1,X=0,y=0,i=1,e.scale<1&&x();const s=+o.maxZoom;e.scale>s&&Y(s,v)}N(t,a),ie(t),r.reset()},p=()=>{const{rootWidth:t,rootHeight:a}=o,s=a/t,{imageRatio:l}=e;T.value=e.imageRatio>s&&l<K,d.value=e.imageRatio>s&&l>=K,d.value&&(b=(l*t-a)/2,e.moveY=b,e.initializing=!0,ce(()=>{e.initializing=!1})),x()},se=t=>{const{naturalWidth:a,naturalHeight:s}=t.target;e.imageRatio=s/a,p()};return O(()=>o.active,x),O(()=>o.show,t=>{t||x()}),O(()=>[o.rootWidth,o.rootHeight],p),le("touchmove",ae,{target:W(()=>{var t;return(t=S.value)==null?void 0:t.$el})}),Q({resetScale:x}),()=>{const t={loading:()=>g(Ie,{type:"spinner"},null)};return g(we,{ref:S,class:L("swipe-item"),onTouchstartPassive:te,onTouchend:B,onTouchcancel:B},{default:()=>[w.image?g("div",{class:L("image-wrap")},[w.image({src:o.src})]):g(xe,{ref:n,src:o.src,fit:"contain",class:L("image",{vertical:T.value}),style:D.value,onLoad:se},t)]})}}});const[ze,Z]=V("image-preview"),Oe=["show","teleport","transition","overlayStyle","closeOnPopstate"],De={show:Boolean,loop:R,images:re(),minZoom:_(1/3),maxZoom:_(3),overlay:R,closeable:Boolean,showIndex:R,className:F,closeIcon:j("clear"),transition:String,beforeClose:Function,doubleScale:R,overlayClass:F,overlayStyle:Object,swipeDuration:_(300),startPosition:_(0),showIndicators:Boolean,closeOnPopstate:R,closeOnClickOverlay:R,closeIconPosition:j("top-right"),teleport:[String,Object]};var He=ee({name:ze,props:De,emits:["scale","close","closed","change","longPress","update:show"],setup(o,{emit:m,slots:w}){const e=z(),r=z(),n=oe({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),S=()=>{if(e.value){const i=J(e.value.$el);n.rootWidth=i.width,n.rootHeight=i.height,e.value.resize()}},T=i=>m("scale",i),d=i=>m("update:show",i),b=()=>{he(o.beforeClose,{args:[n.active],done:()=>d(!1)})},D=i=>{i!==n.active&&(n.active=i,m("change",i))},u=()=>{if(o.showIndex)return g("div",{class:Z("index")},[w.index?w.index({index:n.active}):`${n.active+1} / ${o.images.length}`])},P=()=>{if(w.cover)return g("div",{class:Z("cover")},[w.cover()])},Y=()=>{n.disableZoom=!0},x=()=>{n.disableZoom=!1},$=()=>g(Pe,{ref:e,lazyRender:!0,loop:o.loop,class:Z("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:D,onDragEnd:x,onDragStart:Y},{default:()=>[o.images.map((i,f)=>g(Ze,{ref:v=>{f===n.active&&(r.value=v)},src:i,show:o.show,active:n.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,disableZoom:n.disableZoom,doubleScale:o.doubleScale,closeOnClickOverlay:o.closeOnClickOverlay,onScale:T,onClose:b,onLongPress:()=>m("longPress",{index:f})},{image:w.image}))]}),I=()=>{if(o.closeable)return g(ge,{role:"button",name:o.closeIcon,class:[Z("close-icon",o.closeIconPosition),Ce],onClick:b},null)},X=()=>m("closed"),y=(i,f)=>{var v;return(v=e.value)==null?void 0:v.swipeTo(i,f)};return Q({resetScale:()=>{var i;(i=r.value)==null||i.resetScale()},swipeTo:y}),Te(S),O([me,ve],S),O(()=>o.startPosition,i=>D(+i)),O(()=>o.show,i=>{const{images:f,startPosition:v}=o;i?(D(+v),be(()=>{S(),y(+v,{immediate:!0})})):m("close",{index:n.active,url:f[n.active]})}),()=>g(Se,Ye({class:[Z(),o.className],overlayClass:[Z("overlay"),o.overlayClass],onClosed:X,"onUpdate:show":d},ue(o,Oe)),{default:()=>[I(),$(),u(),P()]})}});const Ae=de(He);export{Ae as I,He as s};
